-- CREATE DATABASE 
USE INVENTARIO_IACSA
GO

--INSTITUCION @ID_INSTITUCION CHAR(40),@NOMBRE VARCHAR(50),@CORREO VARCHAR(30)
EXEC INSERT_INSTITUCIONES "1","COLEGIO AGROPECUARIO","AGRO@GMAIL.COM"

--TELEFONO_INSTITUCIONES @ID_INSTITUCION CHAR(40),@NUMERO CHAR(8)
EXEC INSERT_TELEFONOS "1","8888-8888"
--USUARIOS @ID_USUARIO CHAR(40),@ID_INSTITUCION CHAR(40),@CORREO VARCHAR(50)
--,@NOMBRE VARCHAR(50), @APELLIDO1 VARCHAR(50), @APELLIDO2 VARCHAR(50),@CONTRASENA CHAR(20)
EXEC INSERT_USUARIO "1","1","JOSE@GMAIL.COM","JOSE","SERRANO","QUESADA","123-.ASDF"
EXEC INSERT_USUARIO "2","1","DIEGO@GMAIL.COM","DIEGO","CARRILLO","ARROYO","123-.ASDFF"
EXEC INSERT_USUARIO "3","1","ANTOHNY@GMAIL.COM","ANTHONY","ARIAS","ROBLETO","123-.ASDFFG"
EXEC INSERT_USUARIO "4","1","DIEGO@GMAIL.COM","DIEGO","CARRILLO","ARROYO","asfddvksnbkj"
SELECT * FROM USUARIOS
--UBICACIONES @DETALLE VARCHAR(50), @NOMBRE VARCHAR(50), @ID_INSTITUCION CHAR(40)
EXEC INSERT_UBICACIONES "DETALLE1","AULA A-1","1"
EXEC INSERT_UBICACIONES "DETALLE2","AULA A-2","1"
EXEC INSERT_UBICACIONES "DETALLE3","AULA A-3","1"

--AREAS @NOMBRE CHAR(30),@LOGO VARCHAR(50),@ENCARGADO CHAR(40),@ID_INSTITUCION CHAR(40)
EXEC INSERT_AREA "DEPORTIVA","LOGO1","1","1"
EXEC INSERT_AREA "AGRICULTURA","LOGO2","2","1"
EXEC INSERT_AREA "CIVICA","LOGO1","3","1"

--ACTIVOS @ID_AREA SMALLINT,@NOMBRE_ACTIVO VARCHAR(20),@PLACA INT,
-- @DESCRIPCION VARCHAR(150), @GARANTIA VARCHAR(20), @ID_UBICACION SMALLINT
EXEC INSERT_ACTIVO 1,"COMPUTADOR",123,"DESCRIPCION1","GARANTIA1",1
EXEC INSERT_ACTIVO 2,"SILLA",123,"DESCRIPCION2","GARANTIA2",2
EXEC INSERT_ACTIVO 3,"MESA",1234,"DESCRIPCION3","GARANTIA4",3
EXEC INSERT_ACTIVO 1,"LAMPARA",123,"DESCRIPCION4","GARANTIA5",1
EXEC INSERT_ACTIVO 2,"ARMARIO",12312,"DESCRIPCION5","GARANTIA6",2
EXEC INSERT_ACTIVO 1,'MESA',1234,'DESCRIPCION6','GARANTIA6',1

--PRESTAMOS @id_activo SMALLINT,@solicitante CHAR(40),@estado VARCHAR(50),@fecha_so DATE,@fecha_de DATE
EXEC DELETE_PRESTAMOS 22
EXEC DELETE_PRESTAMOS 21
EXEC DELETE_PRESTAMOS 21
EXEC UPDATE_PRESTAMOS 1,0,'2020-07-21','2022-05-26'
EXEC INSERT_PRESTAMOS 21,1
EXEC INSERT_PRESTAMOS 22,1
EXEC INSERT_PRESTAMOS 23,1
EXEC INSERT_PRESTAMOS 24,2
EXEC INSERT_PRESTAMOS 25,1
EXEC INSERT_PRESTAMOS 26,2
--@ID_ACTIVO SMALLINT,@CONDICION VARCHAR(30),@ID_AREA SMALLINT
--,@PLACA INT, @DESCRIPCION VARCHAR(150), @GARANTIA VARCHAR(20),@ID_UBICACION SMALLINT, @NOMBRE_ACTIVO VARCHAR(20)
EXEC UPDATE_ACTIVO 1,"CONDICION1",2,213,"DESCROPCION","GARANTIA",1,"CASA"
SELECT * FROM USUARIOS
SELECT * FROM UBICACIONES
SELECT* FROM INSTITUCIONES
SELECT * FROM TELEFONOS
SELECT * FROM AREA
SELECT * FROM ACTIVOS   
SELECT * FROM TIPOS
SELECT * FROM CONTROL_ACTIVOS
SELECT * FROM PRESTAMOS

--CODIGO DE PRUEBA PARA CURSOR 2
BEGIN TRANSACTION
DECLARE
	@MAX SMALLINT,
	@ID SMALLINT;
	SET @ID = 1;
	SET @MAX = (SELECT MAX(ID_MENSAJE)FROM MENSAJES);
	WHILE @ID <= @MAX 
	BEGIN
	PRINT(@ID)
	IF 1 = (SELECT COUNT(ID_MENSAJE) FROM MENSAJES WHERE ID_MENSAJE = @ID)
		BEGIN
		PRINT('A')
		UPDATE MENSAJES
			SET 
			[FECHA] = GETDATE()-31
			WHERE @ID = ID_MENSAJE;
		END
	SET @ID = @ID+1
	CONTINUE
	END
SELECT * FROM MENSAJES
EXEC CURSOR2_MENSAJES
SELECT * FROM MENSAJES
ROLLBACK TRANSACTION

BEGIN TRANSACTION
		UPDATE MENSAJES
			SET 
			[FECHA] = GETDATE()
			WHERE 1 = ID_MENSAJE;
		
GO
SELECT * FROM MENSAJES
EXEC CURSOR2_MENSAJES
SELECT * FROM MENSAJES
ROLLBACK TRANSACTION