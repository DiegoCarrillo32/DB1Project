--ACTUALIZA EL ESTADO DE LOS PRESTAMOS SI PRESENTAN ALGUNA MOROSIDAD Y ADEM√ÅS SE CAMBIA LA FECHA DE CONTROL DE CAMBIOS DEL ACTVIO
CREATE PROC CURSOR_PRESTAMOS
AS
    --DECLARE
        --@ESTADO_UPD VARCHAR(30),
        --@FECHA DATE 
    DECLARE CURSOR1 CURSOR FOR SELECT ESTADO_ACTIVO,FECHA_DE,FECHA_CONTROL FROM PRESTAMOS AS P INNER JOIN CONTROL_ACTVIOS AS C_A ON (P.ID_ACTIVO = C_A.ID_ACTIVO)
    OPEN CURSOR1
    FETCH NEXT FROM CURSOR1 
    WHILE @@FETCH_STATUS = 0
    BEGIN 
        IF FECHA_DE < GETDATE()
        BEGIN    
            UPDATE C_A
            SET 
                [ESTADO_ACTIVO] = @ESTADO_UPD,
                [FECHA_CONTROL] = GETDATE()
        END
    END
CLOSE CURSOR1 
DEALLOCATE CURSOR1
--