-- @CONDICION VARCHAR(30),
USE INVENTARIO_IACSA
GO
--INSERTA ACTIVOS Y TIPOS Y MEDIANTE UN TRIGGER CONTROL DE ACTIVOS
CREATE PROCEDURE INSERT_ACTIVO(@ID_AREA SMALLINT,@NOMBRE_ACTIVO VARCHAR(20),@PLACA INT, @DESCRIPCION VARCHAR(150), @GARANTIA VARCHAR(20), @ID_UBICACION SMALLINT)
AS
    DECLARE @ERROR BIT;
    SET @ERROR = 'FALSE';
    BEGIN TRANSACTION
        INSERT INTO ACTIVOS(NOMBRE_ACTIVO,ID_AREA,ID_UBICACION) 
        VALUES (@NOMBRE_ACTIVO,@ID_AREA,@ID_UBICACION)
        IF @@ERROR>0
        BEGIN
            PRINT('ERROR AL INSERTAR EL ACTIVO')
            SET @ERROR = 'TRUE';
        END
    
    INSERT INTO TIPOS(PLACA, DESCRIPCION, GARANTIA) 
    VALUES (@PLACA,@DESCRIPCION,@GARANTIA)
    IF @@ERROR>0
    BEGIN 
        PRINT('ERROR AL INSERTAR TIPOS')
        SET @ERROR = 'TRUE';
    END
    IF @ERROR = 'TRUE'
    BEGIN 
        PRINT('NO SE REGISTRÓ ACTIVO Y TIPOS')
        ROLLBACK TRANSACTION
    END
    ELSE 
    BEGIN 
        PRINT('SE REGISTRÓ ACTIVO Y TIPOS')
        COMMIT TRANSACTION
    END;
GO
--BORRA ACTIVOS,TIPOS Y CONTROL DE ACTIVOS
CREATE PROC DELETE_ACTIVO(@ID_ACTIVO SMALLINT)
AS  
    DECLARE @ERROR BIT;
    SET @ERROR = 'FALSE';
    BEGIN TRANSACTION
    DELETE FROM CONTROL_ACTIVOS
    WHERE @ID_ACTIVO = ID_ACTIVO
    IF @@ERROR>0
    BEGIN
        PRINT('NO SE ELIMINÓ EL ELEMENTO DE CONTROL_ACTIVOS')
        SET @ERROR = 'TRUE'
    END;
    DELETE FROM TIPOS
    WHERE @ID_ACTIVO = ID_ACTIVO
    IF @@ERROR>0
    BEGIN
        PRINT('NO SE ELIMINÓ EL ELEMENTO DE TIPOS')
        SET @ERROR = 'TRUE'
    END;
    DELETE FROM ACTIVOS
    WHERE @ID_ACTIVO = ID_ACTIVO
    IF @@ERROR>0
    BEGIN
        PRINT('NO SE ELIMINÓ EL ELEMENTO DE ACTIVOS')
        SET @ERROR = 'TRUE';
    END;
    IF @ERROR = 'TRUE'
    BEGIN
        PRINT('NO SE PUDO ELIMINAR ACTIVOS Y TIPOS')
        ROLLBACK TRANSACTION
    END
    ELSE
    BEGIN
        PRINT('SE ELIMINÓ ACTIVOS Y TIPOS')
        COMMIT TRANSACTION
    END;
GO

CREATE PROC UPDATE_ACTIVO(@ID_ACTIVO SMALLINT,@CONDICION VARCHAR(30),@ID_AREA SMALLINT,@PLACA INT, @DESCRIPCION VARCHAR(150), @GARANTIA VARCHAR(20),@ID_UBICACION SMALLINT, @NOMBRE_ACTIVO VARCHAR(20))
AS
    DECLARE
        @ERROR BIT;
    SET
        @ERROR = 'FALSE';
    BEGIN TRANSACTION
    UPDATE ACTIVOS
    SET
        [ID_AREA] = @ID_AREA,
        [NOMBRE_ACTIVO] = @NOMBRE_ACTIVO,
        [ID_UBICACION] = @ID_UBICACION
    WHERE @ID_ACTIVO = ID_ACTIVO;
    IF @@ERROR>0
    BEGIN
        PRINT('NO SE PUDO ACTUALIZAR LOS ELEMENTOS DE ACTIVOS')
        SET @ERROR = 'TRUE'
    END
    UPDATE TIPOS
    SET
    [PLACA] = @PLACA,
    [DESCRIPCION] = @DESCRIPCION,
    [GARANTIA] = @GARANTIA
    WHERE @ID_ACTIVO = ID_ACTIVO;
        IF @@ERROR>0
    BEGIN
        PRINT('NO SE PUDO ACTUALIZAR LOS ELEMENTOS DE TIPOS')
        SET @ERROR = 'TRUE'
    END

    UPDATE CONTROL_ACTIVOS
    SET
    [ESTADO_ACTIVO] = @CONDICION,
    [FECHA_CONTROL] = GETDATE()
    WHERE @ID_ACTIVO = ID_ACTIVO;
        IF @@ERROR>0
    BEGIN
        PRINT('NO SE PUDO ACTUALIZAR LOS ELEMENTOS DE CONTROL DE ACTIVO')
        SET @ERROR = 'TRUE'
    END;
    IF @ERROR = 'TRUE'
    BEGIN
        PRINT('NO SE REALIZARON LAS ACTUALIZACIONES DE ACTIVOS, TIPOS Y CONTROL DE ACTIVOS')
        ROLLBACK TRANSACTION
    END
    ELSE
    BEGIN
        PRINT('SE REALIZARON LAS ACTUALIZACIONES DE ACTIVOS, TIPOS Y CONTROL DE ACTIVOS CON ÉXITO')
        COMMIT TRANSACTION
    END;
GO
